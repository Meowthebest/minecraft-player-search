<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NameMC Clone | Profile</title>
    <script src="https://bs-community.github.io/skinview3d/js/skinview3d.bundle.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Space+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Exact NameMC Dark Palette */
            --bg-body: #111111;
            --bg-card: #1f1f1f;
            --bg-darker: #151515;
            --border: 1px solid #333;
            --accent: #53a6f3; /* NameMC Blue */
            --text-main: #fff;
            --text-dim: #aaa;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Navbar */
        .navbar {
            width: 100%;
            background: #151515;
            padding: 12px 0;
            border-bottom: var(--border);
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .search-box {
            display: flex;
            width: 100%;
            max-width: 900px;
            padding: 0 15px;
        }

        .search-box input {
            flex: 1;
            background: #000;
            border: 1px solid #333;
            padding: 10px 15px;
            color: white;
            border-radius: 4px 0 0 4px;
            outline: none;
        }

        .search-box button {
            background: var(--accent);
            border: none;
            color: white;
            padding: 0 20px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        /* Layout Grid */
        .container {
            display: none; /* Hidden until search */
            grid-template-columns: 350px 1fr;
            gap: 20px;
            width: 100%;
            max-width: 1100px;
            padding: 0 20px;
            margin-bottom: 50px;
        }

        /* Left: Skin Viewer */
        .skin-card {
            background: var(--bg-card);
            border: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .skin-canvas-wrapper {
            background: #151515; /* Chequered pattern bg usually goes here */
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: var(--border);
        }

        .skin-buttons {
            display: flex;
        }

        .skin-btn {
            flex: 1;
            background: transparent;
            border: none;
            border-right: var(--border);
            color: var(--text-dim);
            padding: 12px 0;
            cursor: pointer;
            font-size: 13px;
        }
        .skin-btn:last-child { border: none; }
        .skin-btn:hover { background: #252525; color: white; }

        /* Right: Info Panels */
        .profile-header h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
            font-weight: 700;
        }

        .info-panel {
            background: var(--bg-card);
            border: var(--border);
            border-radius: 4px;
            margin-bottom: 20px;
            padding: 15px;
        }

        .panel-title {
            color: var(--accent);
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            color: var(--text-dim);
            padding: 8px 0;
            border-bottom: 1px solid #2a2a2a;
        }
        .data-row:last-child { border: none; }

        /* Capes Grid (Like image_512dfc) */
        .capes-grid {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .cape-slot {
            width: 48px;
            height: 72px;
            background: #151515;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }
        
        .cape-slot:hover { border-color: var(--accent); }
        .cape-slot.active { border-color: #4caf50; background: rgba(76, 175, 80, 0.1); }
        
        .cape-slot img {
            max-width: 100%;
            max-height: 100%;
            image-rendering: pixelated;
        }

        /* Command Box (Like image_512e5d) */
        .command-group {
            display: flex;
            height: 38px;
        }

        .version-select {
            background: #151515;
            color: white;
            border: 1px solid #333;
            border-right: none;
            padding: 0 10px;
            border-radius: 4px 0 0 4px;
            outline: none;
            cursor: pointer;
        }

        .command-input {
            flex: 1;
            background: #0a0a0a;
            border: 1px solid #333;
            color: var(--text-dim);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            padding: 0 12px;
            display: flex;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
        }

        .copy-btn {
            background: #151515;
            border: 1px solid #333;
            border-left: none;
            color: var(--text-dim);
            padding: 0 15px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        .copy-btn:hover { background: #252525; color: white; }

        /* Loading / Error */
        .status-msg { margin-top: 50px; color: var(--text-dim); }
        
        @media(max-width: 800px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="search-box">
            <input type="text" id="username" placeholder="Name or UUID" onkeypress="handleEnter(event)">
            <button onclick="searchUser()"><i class="fas fa-search"></i></button>
        </div>
    </div>

    <div id="loading" class="status-msg" style="display:none;">Searching...</div>
    <div id="error" class="status-msg" style="color:#ff5555; display:none;"></div>

    <div class="container" id="result">
        <div class="skin-card">
            <div class="skin-canvas-wrapper">
                <canvas id="skin_canvas"></canvas>
            </div>
            <div class="skin-buttons">
                <button class="skin-btn" onclick="downloadSkin()">Download</button>
                <button class="skin-btn" onclick="toggleAnimation()">Walk</button>
                <button class="skin-btn" onclick="toggleRotate()">Rotate</button>
            </div>
        </div>

        <div>
            <div class="profile-header">
                <h1 id="nameDisplay">User</h1>
            </div>

            <div class="info-panel">
                <div class="panel-title">Profile</div>
                <div class="data-row">
                    <span>UUID</span>
                    <span id="uuidDisplay">---</span>
                </div>
            </div>

            <div class="info-panel">
                <div class="panel-title">Capes</div>
                <div class="capes-grid" id="capeGrid">
                    <span style="font-size:12px; color:#555;">No equipped capes found.</span>
                </div>
            </div>

            <div class="info-panel">
                <div class="panel-title">Head Command</div>
                <div class="command-group">
                    <select class="version-select" id="versionSelect" onchange="updateCommand()">
                        <option value="modern">1.21</option>
                        <option value="modern">1.20</option>
                        <option value="modern">1.19</option>
                        <option value="modern">1.18</option>
                        <option value="modern">1.17</option>
                        <option value="modern">1.16</option>
                        <option value="modern">1.15</option>
                        <option value="modern">1.14</option>
                        <option value="modern">1.13</option>
                        <option value="legacy">1.12</option>
                        <option value="legacy">1.11</option>
                        <option value="legacy">1.10</option>
                        <option value="legacy">1.9</option>
                        <option value="legacy">1.8</option>
                    </select>
                    <div class="command-input" id="cmdInput">/give...</div>
                    <button class="copy-btn" onclick="copyCmd()">Copy</button>
                </div>
            </div>
            
            <div class="info-panel">
                <div class="panel-title">Name History</div>
                <div id="historyList"></div>
            </div>

        </div>
    </div>

    <script>
        let viewer;
        let isWalking = true;
        let isRotating = false;
        let currentSkinUrl = "";
        let currentName = "";

        function handleEnter(e) { if(e.key === 'Enter') searchUser(); }

        // --- COMMAND LOGIC (Feature from image_512e5d) ---
        function updateCommand() {
            const versionType = document.getElementById('versionSelect').value;
            const display = document.getElementById('cmdInput');
            
            if(!currentName) return;

            if (versionType === 'modern') {
                // 1.13+ Syntax
                display.innerText = `/give @p minecraft:player_head{SkullOwner:"${currentName}"}`;
            } else {
                // 1.12 and older Syntax
                display.innerText = `/give @p minecraft:skull 1 3 {SkullOwner:"${currentName}"}`;
            }
        }

        function copyCmd() {
            const text = document.getElementById('cmdInput').innerText;
            navigator.clipboard.writeText(text);
            alert("Command copied!");
        }

        // --- SEARCH LOGIC ---
        async function searchUser() {
            const input = document.getElementById('username').value.trim();
            if(!input) return;

            // UI Reset
            document.getElementById('result').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';

            try {
                // 1. Fetch Data
                const res = await fetch(`https://api.ashcon.app/mojang/v2/user/${input}`);
                if(!res.ok) throw new Error("Player not found");
                const data = await res.json();

                // 2. Set Basic Info
                currentName = data.username;
                currentSkinUrl = data.textures.skin.url;
                document.getElementById('nameDisplay').innerText = data.username;
                document.getElementById('uuidDisplay').innerText = data.uuid;
                
                // Trigger command update
                updateCommand();

                // 3. History
                const histDiv = document.getElementById('historyList');
                histDiv.innerHTML = '';
                if(data.username_history) {
                    data.username_history.reverse().forEach(h => {
                        const row = document.createElement('div');
                        row.className = 'data-row';
                        const date = h.changed_at ? new Date(h.changed_at).toLocaleDateString() : 'Original';
                        row.innerHTML = `<span>${h.username}</span><span>${date}</span>`;
                        histDiv.appendChild(row);
                    });
                }

                // 4. CAPE GRID (The complex part)
                const capeGrid = document.getElementById('capeGrid');
                capeGrid.innerHTML = '';
                let capesFound = 0;

                // Function to add a cape to the grid
                const addCapeToGrid = (url, type) => {
                    capesFound++;
                    const slot = document.createElement('div');
                    slot.className = 'cape-slot';
                    if(capesFound === 1) slot.classList.add('active'); // Select first found
                    
                    // We render a tiny version of the cape image
                    slot.innerHTML = `<img src="${url}" alt="${type}">`;
                    
                    // Click to preview
                    slot.onclick = () => {
                        viewer.loadCape(url);
                        document.querySelectorAll('.cape-slot').forEach(s => s.classList.remove('active'));
                        slot.classList.add('active');
                    };
                    
                    capeGrid.appendChild(slot);
                };

                // A. Mojang Cape
                if(data.textures.cape) {
                    addCapeToGrid(data.textures.cape.url, 'Mojang');
                }

                // B. OptiFine Cape (Via Proxy)
                const optifineUrl = `http://s.optifine.net/capes/${data.username}.png`;
                const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(optifineUrl)}`;
                
                // Blindly add OptiFine button (Viewer handles 404 silently)
                addCapeToGrid(proxyUrl, 'OptiFine');


                // 5. 3D Viewer
                if(!viewer) {
                    viewer = new skinview3d.SkinViewer({
                        canvas: document.getElementById("skin_canvas"),
                        width: 300,
                        height: 400,
                        skin: currentSkinUrl
                    });
                    viewer.camera.position.z = 60;
                    viewer.animation = new skinview3d.WalkingAnimation();
                } else {
                    viewer.loadSkin(currentSkinUrl);
                    // Load the first found cape automatically
                    if(data.textures.cape) viewer.loadCape(data.textures.cape.url);
                    else viewer.loadCape(proxyUrl);
                }

                document.getElementById('loading').style.display = 'none';
                document.getElementById('result').style.display = 'grid';

            } catch (err) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').innerText = "Error: " + err.message;
                document.getElementById('error').style.display = 'block';
            }
        }

        // --- VIEWER CONTROLS ---
        async function downloadSkin() {
            if(!currentSkinUrl) return;
            const res = await fetch(currentSkinUrl);
            const blob = await res.blob();
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = currentName + ".png";
            a.click();
        }

        function toggleAnimation() {
            isWalking = !isWalking;
            viewer.animation = isWalking ? new skinview3d.WalkingAnimation() : null;
        }
        function toggleRotate() {
            isRotating = !isRotating;
            viewer.autoRotate = isRotating;
        }
    </script>
</body>
</html>
